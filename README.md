Лабораторна робота №7

Тема: Створення фізичної моделі у MSSQL
Мета роботи:
- навчитися створювати таблиці в MS SQL Server;
- коректно обирати типи даних;
- застосовувати обмеження цілісності;
- встановлювати зовнішні ключі;
- виконувати транзакції та службові SQL-скрипти.

Завдання 2 — Опис предметної області та логічної моделі
Опис предметної області: “Продаж квитків на літак”
Аеровокзал працює з певним переліком літаків, які здійснюють рейси між містами.
Відстань між будь-якою парою міст відома.
Ціна квитка визначається типом літака, вартістю польоту за одиницю відстані в салоні певного класу, наявністю або відсутністю комісійного збору для рейсу.
Можлива зміна вартості польоту за одиницю відстані залежно від дати вильоту.

Є розклад рейсів — зазначено, який рейс виконується у які дати.
У рейсу з одним номером обов’язково однаковий тип літака.
- Запити, що повинна підтримувати система:
- Обчислити ціну квитка на вказану дату для вказаного рейсу та класу салону.
- Обчислити ціну квитків на вказаних датах для рейсів з відстанню < заданої.
- Показати міста, до яких можна долетіти, маючи певну суму грошей у визначену дату.
- Показати всі способи долетіти з міста А в місто Б не більше ніж із однією пересадкою.
- Скласти повну відомість цін на квитки на вказану дату для всіх рейсів за типами літаків та класами.

Транзакції:
- Створити новий рейс.
- Змінити вартість польоту.

Завдання 3 — Бізнес-правила
1. Рейс завжди виконується літаком одного типу.
2. Для кожного класу салону в конкретному типі літака існує лише один тариф.
3. Вартість польоту за одиницю відстані залежить від дати (сезону).
4. Комісійний збір визначається рейсом і не змінюється між датами.
5. Вартість квитка розраховується за формулою.
6. Рейс не може бути виконаний у дату, якої немає в розкладі.
7. Місто вильоту та прильоту не можуть збігатися.
8. Відстань рейсу не може бути нульовою чи від’ємною.
9. Рейс повинен мати хоча б один клас обслуговування.
10. Квиток можна продати лише на реальний рейс, який існує у розкладі певної дати.

Завдання 4 — Розгортання СУБД / Неможливість використання віртуальної машини
Проблема: Неможливо імпортувати VirtualBox-образ
При спробі імпорту vdbs2019.ova виникає помилка:
<img width="230" height="541" alt="неможливість" src="https://github.com/user-attachments/assets/ebded706-9a94-485c-a3c7-4992c2b88018" />

Could not create the directory:
C:\Users\angel\VirtualBox VMs\VDBS
(VERR_ACCESS_DENIED)

Код помилки: VBOX_E_IPRT_ERROR (0x80bb0005)

Технічне пояснення:
- VirtualBox намагається створити службові файли в папці профілю користувача.
- Windows повертає ACCESS_DENIED.
- VM доходить до 100%, але не реєструється.
- VirtualBox не може оновити власний файл VirtualBox.xml, тому середовище не запускається.

Висновок:
Запуск віртуальної машини неможливий технічно, тому робота виконувалася в локально встановленому SQL Server 2025 Express.

Локальне середовище:
- SQL Server Express 2025
- SQL Server Management Studio (SSMS)
- DataGrip

Завдання 5 — Версія сервера
SELECT @@VERSION;
<img width="799" height="291" alt="1" src="https://github.com/user-attachments/assets/7c178359-94f4-48cc-9575-ff4a90c9bbee" />
Приклад виводу (може відрізнятися):

Microsoft SQL Server 2025 (RTM)
Express Edition (64-bit)

Завдання 6 Опис таблиці Flights

| **Логічне ім’я**   | **Фізичне ім’я** | **Тип даних T-SQL** | **PKEY** | **FKEY**                     | **NULLS**   | **UNIQUE** |
|--------------------|------------------|----------------------|----------|------------------------------|-------------|------------|
| *ID рейсу*         | `FlightID`       | INT                  | ✔️       | –                            | NOT NULL    | ✔️         |
| *Місто вильоту*    | `FromCity`       | NVARCHAR(50)         | –        | –                            | NOT NULL    | –          |
| *Місто прибуття*   | `ToCity`         | NVARCHAR(50)         | –        | –                            | NOT NULL    | –          |
| *Відстань (км)*    | `Distance`       | INT                  | –        | –                            | NOT NULL    | –          |
| *Тип літака*       | `PlaneType`      | NVARCHAR(50)         | –        | FK → `Plane(PlaneType)`      | NOT NULL    | –          |


Завдання 7 — Скрипт створення таблиці (SETUP.sql)
USE master;
GO

IF OBJECT_ID('Flights', 'U') IS NOT NULL
    DROP TABLE Flights;
GO

CREATE TABLE Flights (
    FlightID INT PRIMARY KEY,
    FromCity NVARCHAR(50) NOT NULL,
    ToCity NVARCHAR(50) NOT NULL,
    Distance INT NOT NULL,
    PlaneType NVARCHAR(50) NOT NULL
);
GO

Синтаксичний розбір:
- CREATE TABLE — створює таблицю.
- FlightID INT PRIMARY KEY — унікальний ідентифікатор рейсу.
- NVARCHAR(50) — текст Unicode.
- Distance INT — довжина рейсу в км.
- NOT NULL — атрибут обов’язковий.
<img width="844" height="391" alt="2" src="https://github.com/user-attachments/assets/869fdba8-b311-4bec-a96f-6e2d91383f19" />

Завдання 8 — Заповнення таблиці даними (INSERT.sql)
USE master;
GO

;WITH N AS (
    SELECT TOP 1000 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n
    FROM sys.objects
)
INSERT INTO Flights (FlightID, FromCity, ToCity, Distance, PlaneType)
SELECT 
    n,
    CONCAT('City', n % 50),
    CONCAT('City', (n + 5) % 50),
    (n % 900) + 100,
    CONCAT('PlaneType', n % 10)
FROM N;

Синтаксичний розбір:
- CTE генерує числа від 1 до 1000.
- City0…City49 — 50 різних міст.
- PlaneType0…PlaneType9 — 10 типів літаків.
- Вставлено ≈141 запис (обмеження sys.objects на SQL Express).
<img width="1044" height="373" alt="3" src="https://github.com/user-attachments/assets/683781b4-c654-4bd0-96e8-e06e560bb2d2" />

Завдання 9 — Видалення створених об'єктів (DELETE.sql)
DROP TABLE IF EXISTS Flights;

Синтаксичний розбір:
- DROP TABLE — видаляє таблицю.
- IF EXISTS — запобігає помилці, якщо таблиця вже видалена.
<img width="626" height="106" alt="4" src="https://github.com/user-attachments/assets/863a1884-4cc8-4581-83a7-bd9bc21b4f8b" />

Висновок
Під час виконання роботи виникла технічна проблема з імпортом та запуском віртуальної машини в VirtualBox. Через системне обмеження VERR_ACCESS_DENIED образ віртуальної машини не був розгорнутий.
Для завершення всіх етапів завдання я:
- встановила SQL Server Express 2025 локально;
- налаштувала TCP/IP, статичний порт та SQL Browser;
- виконала всі завдання через SSMS та DataGrip;
- створила таблиці, заповнила їх даними та підготувала службові скрипти.
Попри неможливість використання віртуальної машини, усі вимоги лабораторної роботи були виконані повністю.

Словник термінів:
https://docs.google.com/document/d/1IT18rIBnTkSIlVkFAKz8r59l4t3yPDM6iLKcQL0WPSY/edit

Конспект:
https://docs.google.com/document/d/14yQNhCpo6himiP9ecccLIL7eqCVLKN6V8wd191O5j9Q/edit
